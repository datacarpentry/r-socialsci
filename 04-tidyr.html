<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>R for Social Scientists: Data Wrangling with tidyr</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/04-tidyr.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      R for Social Scientists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            R for Social Scientists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html"></a></li><li><a class="dropdown-item" href="intro-R-handout.html">Code Handout - Introduction to R</a></li><li><a class="dropdown-item" href="starting-with-data-handout.html">Code Handout - Starting with Data</a></li><li><a class="dropdown-item" href="data-wrangling-handout.html">Code Handout - Data Wrangling with dplyr &amp; tidyr</a></li><li><a class="dropdown-item" href="data-visualisation-handout.html">Code Handout - Data Visualisation with ggplot2</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R for Social Scientists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 49%" class="percentage">
    49%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 49%" aria-valuenow="49" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/04-tidyr.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-intro.html">1. Before we Start</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-intro-to-r.html">2. Introduction to R</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-starting-with-data.html">3. Starting with Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-dplyr.html">4. Data Wrangling with dplyr</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        Data Wrangling with tidyr
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#reshaping-with-pivot_wider-and-pivot_longer">Reshaping with pivot_wider() and pivot_longer()</a></li>
<li><a href="#pivoting-wider">Pivoting wider</a></li>
<li><a href="#pivoting-longer">Pivoting longer</a></li>
<li><a href="#applying-pivot_wider-to-clean-our-data">Applying <code>pivot_wider()</code> to clean our data</a></li>
<li><a href="#exporting-data">Exporting data</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-ggplot2.html">6. Data Visualisation with ggplot2</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="06-rmarkdown.html">7. Getting started with R Markdown (Optional)</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="07-json.html">8. Processing JSON data (Optional)</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html"></a></li><li><a href="intro-R-handout.html">Code Handout - Introduction to R</a></li><li><a href="starting-with-data-handout.html">Code Handout - Starting with Data</a></li><li><a href="data-wrangling-handout.html">Code Handout - Data Wrangling with dplyr &amp; tidyr</a></li><li><a href="data-visualisation-handout.html">Code Handout - Data Visualisation with ggplot2</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="03-dplyr.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="05-ggplot2.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="03-dplyr.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Data Wrangling with</a>
        <a class="chapter-link float-end" href="05-ggplot2.html" rel="next">Next: Data Visualisation... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Data Wrangling with tidyr</h1>
        <p> Last updated on 2023-04-26 | 
        
        <a href="https://github.com/datacarpentry/r-socialsci/edit/main/episodes/04-tidyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I reformat a dataframe to meet my needs?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Describe the concept of a wide and a long table format and for which
purpose those formats are useful.</li>
<li>Describe the roles of variable names and their associated values
when a table is reshaped.</li>
<li>Reshape a dataframe from long to wide format and back with the
<code>pivot_wider</code> and <code>pivot_longer</code> commands from the
<strong><code>tidyr</code></strong> package.</li>
<li>Export a dataframe to a csv file.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p><strong><code>dplyr</code></strong> pairs nicely with
<strong><code>tidyr</code></strong> which enables you to swiftly convert
between different data formats (long vs. wide) for plotting and
analysis. To learn more about <strong><code>tidyr</code></strong> after
the workshop, you may want to check out this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf" class="external-link">handy
data tidying with <strong><code>tidyr</code></strong>
cheatsheet</a>.</p>
<p>To make sure everyone will use the same dataset for this lesson,
we’ll read again the SAFI dataset that we downloaded earlier.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## load the tidyverse</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">here</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interviews</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"SAFI_clean.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="st">"NULL"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## inspect the data</span></span>
<span><span class="va">interviews</span></span>
<span></span>
<span><span class="co">## preview the data</span></span>
<span><span class="co"># view(interviews)</span></span></code></pre>
</div>
<section id="reshaping-with-pivot_wider-and-pivot_longer"><h2 class="section-heading">Reshaping with pivot_wider() and pivot_longer()<a class="anchor" aria-label="anchor" href="#reshaping-with-pivot_wider-and-pivot_longer"></a>
</h2>
<hr class="half-width"><p>There are essentially three rules that define a “tidy” dataset:</p>
<ol style="list-style-type: decimal"><li>Each variable has its own column</li>
<li>Each observation has its own row</li>
<li>Each value must have its own cell</li>
</ol><p>This graphic visually represents the three rules that define a “tidy”
dataset:</p>
<figure><img src="fig/tidy-data-wickham.png" class="figure mx-auto d-block"><em>R for Data Science</em>,
Wickham H and Grolemund G (<a href="https://r4ds.had.co.nz/index.html" class="external-link">https://r4ds.had.co.nz/index.html</a>)
© Wickham, Grolemund 2017 This image is licenced under
Attribution-NonCommercial-NoDerivs 3.0 United States (CC-BY-NC-ND 3.0
US)</figure><p>In this section we will explore how these rules are linked to the
different data formats researchers are often interested in: “wide” and
“long”. This tutorial will help you efficiently transform your data
shape regardless of original format. First we will explore qualities of
the <code>interviews</code> data and how they relate to these different
types of data formats.</p>
<div class="section level3">
<h3 id="long-and-wide-data-formats">Long and wide data formats<a class="anchor" aria-label="anchor" href="#long-and-wide-data-formats"></a></h3>
<p>In the <code>interviews</code> data, each row contains the values of
variables associated with each record collected (each interview in the
villages), where it is stated that the <code>key_ID</code> was “added to
provide a unique Id for each observation” and the
<code>instance_ID</code> “does this as well but it is not as convenient
to use.”</p>
<p>However, with some inspection, we notice that there are more than one
row in the dataset with the same <code>key_ID</code> (as seen below).
However, the <code>instanceID</code>s associated with these duplicate
<code>key_ID</code>s are not the same. Thus, we should think of
<code>instanceID</code> as the unique identifier for observations!</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">key_ID</span>, <span class="va">village</span>, <span class="va">interview_date</span>, <span class="va">instanceID</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 131 × 4
   key_ID village  interview_date      instanceID                               
    &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;                                    
 1      1 God      2016-11-17 00:00:00 uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef
 2      1 God      2016-11-17 00:00:00 uuid:099de9c9-3e5e-427b-8452-26250e840d6e
 3      3 God      2016-11-17 00:00:00 uuid:193d7daf-9582-409b-bf09-027dd36f9007
 4      4 God      2016-11-17 00:00:00 uuid:148d1105-778a-4755-aa71-281eadd4a973
 5      5 God      2016-11-17 00:00:00 uuid:2c867811-9696-4966-9866-f35c3e97d02d
 6      6 God      2016-11-17 00:00:00 uuid:daa56c91-c8e3-44c3-a663-af6a49a2ca70
 7      7 God      2016-11-17 00:00:00 uuid:ae20a58d-56f4-43d7-bafa-e7963d850844
 8      8 Chirodzo 2016-11-16 00:00:00 uuid:d6cee930-7be1-4fd9-88c0-82a08f90fb5a
 9      9 Chirodzo 2016-11-16 00:00:00 uuid:846103d2-b1db-4055-b502-9cd510bb7b37
10     10 Chirodzo 2016-12-16 00:00:00 uuid:8f4e49bc-da81-4356-ae34-e0d794a23721
# ℹ 121 more rows</code></pre>
</div>
<p>As seen in the code below, for each interview date in each village no
<code>instanceID</code>s are the same. Thus, this format is what is
called a “long” data format, where each observation occupies only one
row in the dataframe.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">village</span> <span class="op">==</span> <span class="st">"Chirodzo"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">key_ID</span>, <span class="va">village</span>, <span class="va">interview_date</span>, <span class="va">instanceID</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">sample_n</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 4
   key_ID village  interview_date      instanceID                               
    &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;                                    
 1     34 Chirodzo 2016-11-17 00:00:00 uuid:14c78c45-a7cc-4b2a-b765-17c82b43feb4
 2     59 Chirodzo 2016-11-16 00:00:00 uuid:1936db62-5732-45dc-98ff-9b3ac7a22518
 3     44 Chirodzo 2016-11-17 00:00:00 uuid:f9fadf44-d040-4fca-86c1-2835f79c4952
 4     69 Chirodzo 2016-11-16 00:00:00 uuid:f86933a5-12b8-4427-b821-43c5b039401d
 5     64 Chirodzo 2016-11-16 00:00:00 uuid:28cfd718-bf62-4d90-8100-55fafbe45d06
 6     54 Chirodzo 2016-11-16 00:00:00 uuid:273ab27f-9be3-4f3b-83c9-d3e1592de919
 7     68 Chirodzo 2016-11-16 00:00:00 uuid:ef04b3eb-b47d-412e-9b09-4f5e08fc66f9
 8     50 Chirodzo 2016-11-16 00:00:00 uuid:4267c33c-53a7-46d9-8bd6-b96f58a4f92c
 9     49 Chirodzo 2016-11-16 00:00:00 uuid:2303ebc1-2b3c-475a-8916-b322ebf18440
10     61 Chirodzo 2016-11-16 00:00:00 uuid:2401cf50-8859-44d9-bd14-1bf9128766f2</code></pre>
</div>
<p>We notice that the layout or format of the <code>interviews</code>
data is in a format that adheres to rules 1-3, where</p>
<ul><li>each column is a variable</li>
<li>each row is an observation</li>
<li>each value has its own cell</li>
</ul><p>This is called a “long” data format. But, we notice that each column
represents a different variable. In the “longest” data format there
would only be three columns, one for the id variable, one for the
observed variable, and one for the observed value (of that variable).
This data format is quite unsightly and difficult to work with, so you
will rarely see it in use.</p>
<p>Alternatively, in a “wide” data format we see modifications to rule
1, where each column no longer represents a single variable. Instead,
columns can represent different levels/values of a variable. For
instance, in some data you encounter the researchers may have chosen for
every survey date to be a different column.</p>
<p>These may sound like dramatically different data layouts, but there
are some tools that make transitions between these layouts much simpler
than you might think! The gif below shows how these two formats relate
to each other, and gives you an idea of how we can use R to shift from
one format to the other.</p>
<figure><img src="fig/tidyr-pivot_wider_longer.gif" class="figure mx-auto d-block"> Long and wide
dataframe layouts mainly affect readability. You may find that visually
you may prefer the “wide” format, since you can see more of the data on
the screen. However, all of the R functions we have used thus far expect
for your data to be in a “long” data format. This is because the long
format is more machine readable and is closer to the formatting of
databases.</figure></div>
<div class="section level3">
<h3 id="questions-which-warrant-different-data-formats">Questions which warrant different data formats<a class="anchor" aria-label="anchor" href="#questions-which-warrant-different-data-formats"></a></h3>
<p>In interviews, each row contains the values of variables associated
with each record (the unit), values such as the village of the
respondent, the number of household members, or the type of wall their
house had. This format allows for us to make comparisons across
individual surveys, but what if we wanted to look at differences in
households grouped by different types of housing construction
materials?</p>
<p>To facilitate this comparison we would need to create a new table
where each row (the unit) was comprised of values of variables
associated with housing material (e.g. the
<code>respondent_wall_type</code>). In practical terms this means the
values of the wall construction materials in
<code>respondent_wall_type</code> (e.g. muddaub, burntbricks, cement,
sunbricks) would become the names of column variables and the cells
would contain values of <code>TRUE</code> or <code>FALSE</code>, for
whether that house had a wall made of that material.</p>
<p>Once we we’ve created this new table, we can explore the relationship
within and between villages. The key point here is that we are still
following a tidy data structure, but we have <strong>reshaped</strong>
the data according to the observations of interest.</p>
<p>Alternatively, if the interview dates were spread across multiple
columns, and we were interested in visualizing, within each village, how
irrigation conflicts have changed over time. This would require for the
interview date to be included in a single column rather than spread
across multiple columns. Thus, we would need to transform the column
names into values of a variable.</p>
<p>We can do both these of transformations with two <code>tidyr</code>
functions, <code>pivot_wider()</code> and
<code>pivot_longer()</code>.</p>
</div>
</section><section id="pivoting-wider"><h2 class="section-heading">Pivoting wider<a class="anchor" aria-label="anchor" href="#pivoting-wider"></a>
</h2>
<hr class="half-width"><p><code>pivot_wider()</code> takes three principal arguments:</p>
<ol style="list-style-type: decimal"><li>the data</li>
<li>the <em>names_from</em> column variable whose values will become new
column names.</li>
<li>the <em>values_from</em> column variable whose values will fill the
new column variables.</li>
</ol><p>Further arguments include <code>values_fill</code> which, if set,
fills in missing values with the value provided.</p>
<p>Let’s use <code>pivot_wider()</code> to transform interviews to
create new columns for each type of wall construction material. We will
make use of the pipe operator as have done before. Because both the
<code>names_from</code> and <code>values_from</code> parameters must
come from column values, we will create a dummy column (we’ll name it
<code>wall_type_logical</code>) to hold the value <code>TRUE</code>,
which we will then place into the appropriate column that corresponds to
the wall construction material for that respondent. When using
<code>mutate()</code> if you give a single value, it will be used for
all observations in the dataset.</p>
<p>For each row in our newly pivoted table, only one of the newly
created wall type columns will have a value of <code>TRUE</code>, since
each house can only be made of one wall type. The default value that
<code>pivot_wider</code> uses to fill the other wall types is
<code>NA</code>.</p>
<figure><img src="fig/pivot_long_to_wide.png" class="figure mx-auto d-block"></figure><p>If instead of the default value being <code>NA</code>, we wanted
these values to be <code>FALSE</code>, we can insert a default value
into the <code>values_fill</code> argument. By including
<code>values_fill = list(wall_type_logical = FALSE)</code> inside
<code>pivot_wider()</code>, we can fill the remainder of the wall type
columns for that row with the value <code>FALSE</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_wide</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>wall_type_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">respondent_wall_type</span>,</span>
<span>                values_from <span class="op">=</span> <span class="va">wall_type_logical</span>,</span>
<span>                values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>wall_type_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>View the <code>interviews_wide</code> dataframe and notice that there
is no longer a column titled <code>respondent_wall_type</code>. This is
because there is a default parameter in <code>pivot_wider()</code> that
drops the original column. The values that were in that column have now
become columns named <code>muddaub</code>, <code>burntbricks</code>,
<code>sunbricks</code>, and <code>cement</code>. You can use
<code>dim(interviews)</code> and <code>dim(interviews_wide)</code> to
see how the number of columns has changed between the two datasets.</p>
</section><section id="pivoting-longer"><h2 class="section-heading">Pivoting longer<a class="anchor" aria-label="anchor" href="#pivoting-longer"></a>
</h2>
<hr class="half-width"><p>The opposing situation could occur if we had been provided with data
in the form of <code>interviews_wide</code>, where the building
materials are column names, but we wish to treat them as values of a
<code>respondent_wall_type</code> variable instead.</p>
<p>In this situation we are gathering these columns turning them into a
pair of new variables. One variable includes the column names as values,
and the other variable contains the values in each cell previously
associated with the column names. We will do this in two steps to make
this process a bit clearer.</p>
<p><code>pivot_longer()</code> takes four principal arguments:</p>
<ol style="list-style-type: decimal"><li>the data</li>
<li>
<em>cols</em> are the names of the columns we use to fill the a new
values variable (or to drop).</li>
<li>the <em>names_to</em> column variable we wish to create from the
<em>cols</em> provided.</li>
<li>the <em>values_to</em> column variable we wish to create and fill
with values associated with the <em>cols</em> provided.</li>
</ol><p>To recreate our original dataframe, we will use the following:</p>
<ol style="list-style-type: decimal"><li>the data - <code>interviews_wide</code>
</li>
<li>a list of <em>cols</em> (columns) that are to be reshaped; these can
be specified using a <code>:</code> if the columns to be reshaped are in
one area of the dataframe, or with a vector (<code>c()</code>) command
if the columns are spread throughout the dataframe.</li>
<li>the <em>names_to</em> column will be a character string of the name
the column these columns will be collapsed into
(“respondent_wall_type”).</li>
<li>the <em>values_to</em> column will be a character string of the name
of the column the values of the collapsed columns will be inserted into
(“wall_type_logical”). This column will be populated with values of
<code>TRUE</code> or <code>FALSE</code>.</li>
</ol><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_long</span> <span class="op">&lt;-</span> <span class="va">interviews_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"muddaub"</span>, <span class="st">"cement"</span>, <span class="st">"sunbricks"</span>, <span class="st">"burntbricks"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"respondent_wall_type"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"wall_type_logical"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/pivot_wide_to_long.png" class="figure mx-auto d-block"></figure><p>This creates a dataframe with 524 rows (4 rows per interview
respondent). The four rows for each respondent differ only in the value
of the “respondent_wall_type” and “wall_type_logical” columns. View the
data to see what this looks like.</p>
<p>Only one row for each interview respondent is informative–we know
that if the house walls are made of “sunbrick” they aren’t made of any
other the other materials. Therefore, it would make sense to filter our
dataset to only keep values where <code>wall_type_logical</code> is
<code>TRUE</code>. Because <code>wall_type_logical</code> is already
either <code>TRUE</code> or <code>FALSE</code>, when passing the column
name to <code>filter()</code>, it will automatically already only keep
rows where this column has the value <code>TRUE</code>. We can then
remove the <code>wall_type_logical</code> column.</p>
<p>We do all of these steps together in the next chunk of code:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_long</span> <span class="op">&lt;-</span> <span class="va">interviews_wide</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">burntbricks</span>, <span class="va">cement</span>, <span class="va">muddaub</span>, <span class="va">sunbricks</span><span class="op">)</span>,</span>
<span>                 names_to <span class="op">=</span> <span class="st">"respondent_wall_type"</span>,</span>
<span>                 values_to <span class="op">=</span> <span class="st">"wall_type_logical"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">wall_type_logical</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">wall_type_logical</span><span class="op">)</span></span></code></pre>
</div>
<p>View both <code>interviews_long</code> and
<code>interviews_wide</code> and compare their structure.</p>
</section><section id="applying-pivot_wider-to-clean-our-data"><h2 class="section-heading">Applying <code>pivot_wider()</code> to clean our data<a class="anchor" aria-label="anchor" href="#applying-pivot_wider-to-clean-our-data"></a>
</h2>
<hr class="half-width"><p>Now that we’ve learned about <code>pivot_longer()</code> and
<code>pivot_wider()</code> we’re going to put these functions to use to
fix a problem with the way that our data is structured. In the
spreadsheets lesson, we learned that it’s best practice to have only a
single piece of information in each cell of your spreadsheet. In this
dataset, we have several columns which contain multiple pieces of
information. For example, the <code>items_owned</code> column contains
information about whether our respondents owned a fridge, a television,
etc. To make this data easier to analyze, we will split this column and
create a new column for each item. Each cell in that column will either
be <code>TRUE</code> or <code>FALSE</code> and will indicate whether
that interview respondent owned that item (similar to what we did
previously with <code>wall_type</code>).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_items_owned</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">items_owned</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">replace_na</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>items_owned <span class="op">=</span> <span class="st">"no_listed_items"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">items_owned</span>,</span>
<span>                values_from <span class="op">=</span> <span class="va">items_owned_logical</span>,</span>
<span>                values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">interviews_items_owned</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 131</code></pre>
</div>
<p>There are a couple of new concepts in this code chunk, so let’s walk
through it line by line. First we create a new object
(<code>interviews_items_owned</code>) based on the
<code>interviews</code> dataframe.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>interviews_items_owned <span class="ot">&lt;-</span> interviews <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>Then we use the new function <code>separate_rows()</code> from the
<strong><code>tidyr</code></strong> package to separate the values of
<code>items_owned</code> based on the presence of semi-colons
(<code>;</code>). The values of this variable were multiple items
separated by semi-colons, so this action creates a row for each item
listed in a household’s possession. Thus, we end up with a long format
version of the dataset, with multiple rows for each respondent. For
example, if a respondent has a television and a solar panel, that
respondent will now have two rows, one with “television” and the other
with “solar panel” in the <code>items_owned</code> column.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">separate_rows</span>(items_owned, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>You may notice that one of the columns is called <code>´NA´</code>.
This is because some of the respondents did not own any of the items
that was in the interviewer’s list. We can use the
<code>replace_na()</code> function to change these <code>NA</code>
values to something more meaningful. The <code>replace_na()</code>
function expects for you to give it a <code>list()</code> of columns
that you would like to replace the <code>NA</code> values in, and the
value that you would like to replace the <code>NA</code>s. This ends up
looking like this:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">items_owned =</span> <span class="st">"no_listed_items"</span>)) <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>Next, we create a new variable named
<code>items_owned_logical</code>, which has one value
(<code>TRUE</code>) for every row. This makes sense, since each item in
every row was owned by that household. We are constructing this variable
so that when spread the <code>items_owned</code> across multiple
columns, we can fill the values of those columns with logical values
describing whether the household did (<code>TRUE</code>) or didn’t
(<code>FALSE</code>) own that particular item.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">items_owned_logical =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span></code></pre>
</div>
<p>Lastly, we use <code>pivot_wider()</code> to switch from long format
to wide format. This creates a new column for each of the unique values
in the <code>items_owned</code> column, and fills those columns with the
values of <code>items_owned_logical</code>. We also declare that for
items that are missing, we want to fill those cells with the value of
<code>FALSE</code> instead of <code>NA</code>.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">items_owned</span>,</span>
<span>            values_from <span class="op">=</span> <span class="va">items_owned_logical</span>,</span>
<span>            values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>View the <code>interviews_items_owned</code> dataframe. It should
have 131 rows (the same number of rows you had originally), but extra
columns for each item. How many columns were added?</p>
<p>This format of the data allows us to do interesting things, like make
a table showing the number of respondents in each village who owned a
particular item:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_items_owned</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">bicycle</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">bicycle</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 3
# Groups:   village [3]
  village  bicycle     n
  &lt;chr&gt;    &lt;lgl&gt;   &lt;int&gt;
1 Chirodzo TRUE       17
2 God      TRUE       23
3 Ruaca    TRUE       20</code></pre>
</div>
<p>Or below we calculate the average number of items from the list owned
by respondents in each village. This code uses the
<code>rowSums()</code> function to count the number of <code>TRUE</code>
values in the <code>bicycle</code> to <code>car</code> columns for each
row, hence its name. Note that we replaced <code>NA</code> values with
the value <code>no_listed_items</code>, so we must exclude this value in
the aggregation. We then group the data by villages and calculate the
mean number of items, so each average is grouped by village.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_items_owned</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>number_items <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">bicycle</span><span class="op">:</span><span class="va">car</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>mean_items <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">number_items</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  village  mean_items
  &lt;chr&gt;         &lt;dbl&gt;
1 Chirodzo       4.62
2 God            4.07
3 Ruaca          5.63</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal"><li>Create a new dataframe (named
<code>interviews_months_lack_food</code>) that has one column for each
month and records <code>TRUE</code> or <code>FALSE</code> for whether
each interview respondent was lacking food in that month.</li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_months_lack_food</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">months_lack_food</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>months_lack_food_logical  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">months_lack_food</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">months_lack_food_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise" class="callout-inner">
<h3 class="callout-title">Exercise<em> (continued)</em><a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<ol start="2" style="list-style-type: decimal"><li>How many months (on average) were respondents without food if they
did belong to an irrigation association? What about if they didn’t?</li>
</ol></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_months_lack_food</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_months <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">Jan</span><span class="op">:</span><span class="va">May</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">memb_assoc</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_months <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">number_months</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  memb_assoc mean_months
  &lt;chr&gt;            &lt;dbl&gt;
1 no                2   
2 yes               2.30
3 &lt;NA&gt;              2.82</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="exporting-data"><h2 class="section-heading">Exporting data<a class="anchor" aria-label="anchor" href="#exporting-data"></a>
</h2>
<hr class="half-width"><p>Now that you have learned how to use
<strong><code>dplyr</code></strong> and
<strong><code>tidyr</code></strong> to wrangle your raw data, you may
want to export these new data sets to share them with your collaborators
or for archival purposes.</p>
<p>Similar to the <code>read_csv()</code> function used for reading CSV
files into R, there is a <code>write_csv()</code> function that
generates CSV files from dataframes.</p>
<p>Before using <code>write_csv()</code>, we are going to create a new
folder, <code>data_output</code>, in our working directory that will
store this generated dataset. We don’t want to write generated datasets
in the same directory as our raw data. It’s good practice to keep them
separate. The <code>data</code> folder should only contain the raw,
unaltered data, and should be left alone to make sure we don’t delete or
modify it. In contrast, our script will generate the contents of the
<code>data_output</code> directory, so even if the files it contains are
deleted, we can always re-generate them.</p>
<p>In preparation for our next lesson on plotting, we are going to
create a version of the dataset where each of the columns includes only
one data value. To do this, we will use <code>pivot_wider</code> to
expand the <code>months_lack_food</code> and <code>items_owned</code>
columns. We will also create a couple of summary columns.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interviews_plotting</span> <span class="op">&lt;-</span> <span class="va">interviews</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by items_owned</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">items_owned</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## if there were no items listed, changing NA to no_listed_items</span></span>
<span>  <span class="fu">replace_na</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>items_owned <span class="op">=</span> <span class="st">"no_listed_items"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">items_owned</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">items_owned_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>items_owned_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## pivot wider by months_lack_food</span></span>
<span>  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">months_lack_food</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">months_lack_food</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">months_lack_food_logical</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>months_lack_food_logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">## add some summary columns</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_months_lack_food <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">Jan</span><span class="op">:</span><span class="va">May</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>number_items <span class="op">=</span> <span class="fu">rowSums</span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">.</span>, <span class="va">bicycle</span><span class="op">:</span><span class="va">car</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can save this dataframe to our <code>data_output</code>
directory.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span> <span class="op">(</span><span class="va">interviews_plotting</span>, file <span class="op">=</span> <span class="st">"data_output/interviews_plotting.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Use the <code>tidyr</code> package to change the layout of
dataframes.</li>
<li>Use <code>pivot_wider()</code> to go from long to wide format.</li>
<li>Use <code>pivot_longer()</code> to go from wide to long format.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="03-dplyr.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="05-ggplot2.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="03-dplyr.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Data Wrangling with</a>
        <a class="chapter-link float-end" href="05-ggplot2.html" rel="next">Next: Data Visualisation... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/datacarpentry/r-socialsci/edit/main/episodes/04-tidyr.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/datacarpentry/r-socialsci/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/datacarpentry/r-socialsci/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/r-socialsci/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.11.15" class="external-link">sandpaper (0.11.15)</a>,
        <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.5.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.16" class="external-link">varnish (0.2.16)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.org/r-socialsci/04-tidyr.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Data Wrangling with tidyr",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.org/r-socialsci/04-tidyr.html",
  "identifier": "https://datacarpentry.org/r-socialsci/04-tidyr.html",
  "dateCreated": "2017-05-25",
  "dateModified": "2023-04-26",
  "datePublished": "2023-05-02"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

